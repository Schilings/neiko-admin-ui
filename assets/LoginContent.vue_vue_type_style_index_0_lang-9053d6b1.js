/* empty css                */import{_ as j}from"./index-da51896f.js";import{B as q}from"./index-cf5fb184.js";/* empty css              */import{A as G}from"./index-6d8533be.js";import{T as K}from"./index-c9d35858.js";import{v as Y,D as Q}from"./useConfigInject-4e7e38f3.js";import{u as Z}from"./vue-router-ecc405fe.js";import{_ as ee}from"./logo-373fc820.js";import{_ as te}from"./AccountLoginForm.vue_vue_type_script_setup_true_lang-5d9c9042.js";import{_ as se}from"./MobileLoginForm.vue_vue_type_script_setup_true_lang-7727d1a2.js";import{h as V,u as ae}from"./index-d8cf9b9f.js";import{P as oe,a as ne}from"./constants-2bea6948.js";import{d as U,R as u,K as F,a1 as $,u as c,o as B,a6 as H,a7 as s,aa as N,_ as ie,a8 as ce,a9 as re,S as de,ab as T,ac as P,a as f,w as X,W as O,c as le,ad as me,a5 as W}from"./runtime-core.esm-bundler-e620233b.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as _e}from"./index-38730972.js";import{C as pe}from"./index-d551a8fd.js";import{_ as ge,a as fe,b as he}from"./WeiboOutlined-e3ec1835.js";function ve(o){return V.get("/captcha/tianai/gen",{params:{type:o}})}function ye(o,e){return V.post("/captcha/tianai/check",e,{params:{id:o}})}const be=(o={})=>{let e={};function I(t,n,r,a,d){e={startTime:new Date,trackArr:[],movePercent:0,bgImageWidth:t,bgImageHeight:n,sliderImageWidth:r,sliderImageHeight:a,end:d}}const _=t=>{var p;const n=t==null?void 0:t.targetTouches;let r=t==null?void 0:t.pageX,a=t==null?void 0:t.pageY;r===void 0&&(r=Math.round(n[0].pageX),a=Math.round(n[0].pageY)),e.startX=r,e.startY=a;const d=e.startX,b=e.startY,k=e.startTime;e.trackArr.push({x:d-r,y:b-a,type:"down",t:new Date().getTime()-k.getTime()}),window.addEventListener("mousemove",y),window.addEventListener("mouseup",h),window.addEventListener("touchmove",y,!1),window.addEventListener("touchend",h,!1),(p=o.doDown)==null||p.call(o,e)};function y(t){var l;let n=t;window.TouchEvent&&t instanceof TouchEvent&&(n=t.touches[0]);const r=Math.round(n.pageX),a=Math.round(n.pageY),d=e.startX,b=e.startY,k=e.startTime,w=e.end,p=e.bgImageWidth,C=e.trackArr;let v=r-d;const R={x:r-d,y:a-b,type:"move",t:new Date().getTime()-k.getTime()};C.push(R),v<0?v=0:v>w&&(v=w),e.moveX=v,e.movePercent=v/p,(l=o.doMove)==null||l.call(o,e)}function h(t){var C;let n=t;window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",y),window.removeEventListener("touchend",h),window.TouchEvent&&t instanceof TouchEvent&&(n=t.changedTouches[0]),e.stopTime=new Date;const r=Math.round(n.pageX),a=Math.round(n.pageY),d=e.startX,b=e.startY,k=e.startTime,w=e.trackArr,p={x:r-d,y:a-b,type:"up",t:new Date().getTime()-k.getTime()};w.push(p),(C=o.valid)==null||C.call(o,e)}return{initConfig:I,down:_}},ke=o=>(ce("data-v-1de34a77"),o=o(),re(),o),we={class:"captcha-mask"},Ce={class:"slider"},Te={class:"content"},Ee={class:"bg-img-div"},Le=["src"],xe={class:"slider-img-div"},Se=["src"],Ie={class:"slider-move"},Re=ke(()=>s("div",{class:"slider-move-track"},"拖动滑块完成拼图",-1)),Xe=U({__name:"SliderCaptcha",props:{onSuccess:{type:Function,default(){}}},setup(o,{expose:e}){const I=o,_=u(!1);function y(){_.value=!0}function h(){_.value=!1}const t=u(),n=u(),r=u(),a=u(0),d=u(!1),b=F(()=>({transform:`translateX(${a.value}px)`})),k=F(()=>({transform:`translateX(${a.value}px)`,backgroundPosition:d.value?"-5px 31.0092%":"-5px 11.79625%"}));function w(){a.value=0,d.value=!1}function p(){w(),ve().then(i=>{r.value=i,ie(()=>{l(t.value.width,t.value.height,n.value.width,n.value.height,206)})})}function C(){d.value=!0}function v(i){a.value=i.moveX}function R(i){const{bgImageWidth:g,bgImageHeight:L,sliderImageWidth:x,sliderImageHeight:E,startTime:M,stopTime:A,trackArr:z}=i,D={bgImageWidth:g,bgImageHeight:L,sliderImageWidth:x,sliderImageHeight:E,startSlidingTime:M,endSlidingTime:A,trackList:z},{id:S}=r.value;ye(S,D).then(J=>{J?(I.onSuccess(S),h()):p()})}const{initConfig:l,down:m}=be({doDown:C,doMove:v,valid:R});return e({show(){p(),y()}}),(i,g)=>{var L,x;return $((B(),H("div",we,[s("div",Ce,[s("div",Te,[s("div",Ee,[s("img",{ref_key:"bgImgRef",ref:t,alt:"",src:(L=c(r))==null?void 0:L.captcha.backgroundImage},null,8,Le)]),s("div",xe,[s("img",{ref_key:"sliderImgRef",ref:n,style:N(c(b)),src:(x=c(r))==null?void 0:x.captcha.sliderImage,alt:""},null,12,Se)])]),s("div",Ie,[Re,s("div",{class:"slider-move-btn",style:N(c(k)),onMousedown:g[0]||(g[0]=(...E)=>c(m)&&c(m)(...E)),onTouchstart:g[1]||(g[1]=Q((...E)=>c(m)&&c(m)(...E),["prevent"]))},null,36)]),s("div",{class:"bottom"},[s("div",{class:"close-btn",style:{"margin-right":"6px"},onClick:h}),s("div",{class:"refresh-btn",onClick:p})])])],512)),[[Y,c(_)]])}}});const Me=ue(Xe,[["__scopeId","data-v-1de34a77"]]);const Ae=s("img",{alt:"logo",src:ee},null,-1),ze=[Ae],De={style:{"margin-bottom":"24px"}},Ye=s("a",{style:{float:"right"}},"忘记密码",-1),$e=s("span",null,"其他登录方式",-1),Be=s("a",{style:{float:"right"}}," 注册账户 ",-1),at=U({__name:"LoginContent",setup(o){const e="ant",I="pro-login-content";function _(l){return`${e}-${I}-${l}`}const y=u(!1),h=u(!1),t=u(""),n=u(!1),r=u(),a=u("account");let d=u();const b=u(),k=u();de(()=>{switch(a.value){case"account":d=b;break;case"mobile":d=k;break}});function w(l){const m=ae();m.accessToken=l.access_token;const i=l.info,g=l.attributes||{};m.userInfo={...i,roleCodes:g.roleCodes,permissions:g.permissions}}function p(){d.value,v(" ")}const C=Z();function v(l){const m=d.value;return y.value=!0,m.doLogin(l).then(i=>{h.value=!1,i=R(i),console.log(i),w(i);const g=C.currentRoute.value.query.redirect||"/";C.push(g)}).catch(i=>{h.value=!0,t.value=((i.response||{}).data||{}).message||"请求出现错误，请稍后再试"}).finally(()=>{y.value=!1})}function R(l){const m={permissions:["system:dict:read","notify:announcement:add","system:config:del","system:menu:add","system:role:grant","notify:announcement:edit","notify:announcement:read","system:dict:edit","notify:userannouncement:read","system:user:edit","system:config:read","system:menu:read","system:organization:edit","system:role:edit","system:organization:add","system:user:add","system:user:pass","system:user:read","notify:announcement:del","system:user:del","i18n:i18n-data:del","system:role:add","system:dict:add","system:organization:read","system:role:read","system:dict:del","log:operation-log:read","system:organization:revised","system:role:del","system:user:grant","system:organization:del","i18n:i18n-data:export","system:menu:del","i18n:i18n-data:import","system:config:add","i18n:i18n-data:read","i18n:i18n-data:edit","log:access-log:read","log:login-log:read","system:config:edit","system:menu:edit","i18n:i18n-data:add","authorization:registeredClient:add","authorization:registeredClient:edit","authorization:registeredClient:read","authorization:registeredClient:del"],roleCodes:["ROLE_TEST","ROLE_ADMIN","ROLE_SALES_EXECUTIVE","ROLE_SALESMAN"]},i={userId:1,username:"admin",nickname:"超管牛逼",avatar:"sysuser/1/avatar/20200226/ab6bd5221afe4238ae4987f278758113.jpg",organizationId:6,type:1};return l.attributes=m,l.info=i,l}return(l,m)=>{const i=_e,g=K,L=G,x=pe,E=q,M=ge,A=fe,z=he,D=j;return B(),H("div",{class:T(_("container"))},[s("div",{class:T(_("top"))},[s("div",{class:T(_("header"))},[s("span",{class:T(_("logo"))},ze,2),s("span",{class:T(_("title"))},P(c(oe)),3)],2),s("div",{class:T(_("desc"))},P(c(ne)),3)],2),s("div",{class:T(_("main")),style:{width:"368px"}},[f(g,{"active-key":c(a),"onUpdate:active-key":m[0]||(m[0]=S=>O(a)?a.value=S:null),class:"login-tabs"},{default:X(()=>[f(i,{key:"account",tab:"账号密码登录"}),f(i,{key:"mobile",tab:"手机号登录"})]),_:1},8,["active-key"]),c(h)?(B(),le(L,{key:0,style:{"margin-bottom":"24px"},message:c(t),type:"error","show-icon":""},null,8,["message"])):me("",!0),$(f(te,{ref_key:"accountLoginFormRef",ref:b,onTrySubmit:p},null,512),[[Y,c(a)==="account"]]),$(f(se,{ref_key:"mobileLoginFormRef",ref:k},null,512),[[Y,c(a)==="mobile"]]),s("div",De,[f(x,{checked:c(n),"onUpdate:checked":m[1]||(m[1]=S=>O(n)?n.value=S:null),"no-style":"",name:"autoLogin"},{default:X(()=>[W(" 自动登录")]),_:1},8,["checked"]),Ye]),f(E,{size:"large",type:"primary",style:{width:"100%"},loading:c(y),onClick:p},{default:X(()=>[W(" 登录 ")]),_:1},8,["loading"]),s("div",{class:T(_("other"))},[f(D,{size:8},{default:X(()=>[$e,f(M,{class:"icon"}),f(A,{class:"icon"}),f(z,{class:"icon"})]),_:1}),Be],2)],2),f(c(Me),{ref_key:"loginCaptchaRef",ref:r,onSuccess:v},null,512)],2)}}});export{at as _};
